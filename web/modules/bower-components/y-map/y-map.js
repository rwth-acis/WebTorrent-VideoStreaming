!function e(t,n,r){function s(o,a){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){var t=function(){function t(n,s,i,o){var a=this;r(this,t),this._model=s.id,this.os=n,this.map=e.utils.copyObject(s.map),this.contents=i,this.opContents=o,this.eventHandler=new e.utils.EventHandler(function(t){var n,r="Delete"===t.struct?t.key:t.parentSub;if(null!=a.opContents[r]?!function(){var e=a.opContents[r];n=function(){return new Promise(function(t){a.os.requestTransaction(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.delegateYield(this.getType(e),"t0",1);case 1:r=n.t0,t(r);case 3:case"end":return n.stop()}},n,this)}))})}}():n=a.contents[r],"Insert"===t.struct){if(null===t.left){var s;null!=t.opContent?(s=function(){return new Promise(function(e){a.os.requestTransaction(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.delegateYield(this.getType(t.opContent),"t0",1);case 1:r=n.t0,e(r);case 3:case"end":return n.stop()}},n,this)}))})},delete a.contents[r],t.deleted?delete a.opContents[r]:a.opContents[r]=t.opContent):(s=t.content[0],delete a.opContents[r],t.deleted?delete a.contents[r]:a.contents[r]=t.content[0]),a.map[r]=t.id,void 0===n?a.eventHandler.callEventListeners({name:r,object:a,type:"add",value:s}):a.eventHandler.callEventListeners({name:r,object:a,oldValue:n,type:"update",value:s})}}else{if("Delete"!==t.struct)throw new Error("Unexpected Operation!");e.utils.compareIds(a.map[r],t.target)&&(delete a.opContents[r],delete a.contents[r],a.eventHandler.callEventListeners({name:r,object:a,oldValue:n,type:"delete"}))}})}return i(t,[{key:"_destroy",value:function(){this.eventHandler.destroy(),this.eventHandler=null,this.contents=null,this.opContents=null,this._model=null,this.os=null,this.map=null}},{key:"get",value:function(e){var t=this;if(null==e||"string"!=typeof e)throw new Error("You must specify a key (as string)!");return null==this.opContents[e]?this.contents[e]:new Promise(function(n){var r=t.opContents[e];t.os.requestTransaction(regeneratorRuntime.mark(function s(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(this.getType(r),"t0",1);case 1:e=t.t0,n(e);case 3:case"end":return t.stop()}},s,this)}))})}},{key:"keys",value:function(){return Object.keys(this.contents).concat(Object.keys(this.opContents))}},{key:"keysPrimitives",value:function(){return Object.keys(this.contents)}},{key:"keysTypes",value:function(){return Object.keys(this.opContents)}},{key:"getPrimitive",value:function(t){if(null==t)return e.utils.copyObject(this.contents);if("string"!=typeof t)throw new Error("Key is expected to be a string!");return this.contents[t]}},{key:"getType",value:function(e){var t=this;if(null==e||"string"!=typeof e)throw new Error("You must specify a key (as string)!");return null!=this.opContents[e]?new Promise(function(n){var r=t.opContents[e];t.os.requestTransaction(regeneratorRuntime.mark(function s(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(this.getType(r),"t0",1);case 1:e=t.t0,n(e);case 3:case"end":return t.stop()}},s,this)}))}):Promise.reject("No property specified for this key!")}},{key:"delete",value:function(t){var n=this.map[t];if(null!=n){var r={target:n,struct:"Delete"},s=this.eventHandler,i=e.utils.copyObject(r);i.key=t,this.os.requestTransaction(regeneratorRuntime.mark(function o(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(s.awaitOps(this,this.applyCreatedOperations,[[r]]),"t0",1);case 1:case"end":return e.stop()}},o,this)})),s.awaitAndPrematurelyCall([i])}}},{key:"set",value:function(t,n){var r=this,s=this.map[t]||null,i={id:this.os.getNextOpId(1),left:null,right:s,origin:null,parent:this._model,parentSub:t,struct:"Insert"},o=this.eventHandler;return new Promise(function(t){var s=e.utils.isTypeDefinition(n);if(s!==!1){var a=r.os.getNextOpId(1);i.opContent=a,r.os.requestTransaction(regeneratorRuntime.mark(function u(){var e;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.delegateYield(this.createType(s,a),"t0",1);case 1:return e=n.t0,n.delegateYield(o.awaitOps(this,this.applyCreatedOperations,[[i]]),"t1",3);case 3:t(e);case 4:case"end":return n.stop()}},u,this)})),o.awaitAndPrematurelyCall([i])}else i.content=[n],r.os.requestTransaction(regeneratorRuntime.mark(function c(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(o.awaitOps(this,this.applyCreatedOperations,[[i]]),"t0",1);case 1:case"end":return e.stop()}},c,this)})),o.awaitAndPrematurelyCall([i]),t(n)})}},{key:"observe",value:function(e){this.eventHandler.addEventListener(e)}},{key:"unobserve",value:function(e){this.eventHandler.removeEventListener(e)}},{key:"observePath",value:function(t,n){function r(e){if(e.name===i){var t=s.get(i);t instanceof Promise?t.then(n):n(t)}}var s=this;if(t.length<1)return n(this),Promise.resolve(function(){});if(1===t.length){var i=t[0],o=s.get(i);return o instanceof Promise?o.then(n):n(o),this.observe(r),Promise.resolve(function(){s.unobserve(n)})}var a,u=function(){var r=s.get(t[0]);return!r instanceof Promise&&(r=s.set(t[0],e.Map)),r.then(function(e){return e.observePath(t.slice(1),n)}).then(function(e){return a=e,Promise.resolve()})},c=function(e){e.name===t[0]&&(null!=a&&a(),("add"===e.type||"update"===e.type)&&u())};return s.observe(c),u().then(function(){return Promise.resolve(function(){null!=a&&a(),s.unobserve(c)})})}},{key:"_changed",value:regeneratorRuntime.mark(function n(e,t){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("Delete"!==t.struct){n.next=4;break}return n.delegateYield(e.getOperation(t.target),"t0",2);case 2:r=n.t0,t.key=r.parentSub;case 4:this.eventHandler.receivedOp(t);case 5:case"end":return n.stop()}},n,this)})}]),t}();e.extend("Map",new e.utils.CustomType({name:"Map","class":t,struct:"Map",initType:regeneratorRuntime.mark(function n(e,r){var s,i,o,a,u;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:s={},i={},o=r.map,n.t0=regeneratorRuntime.keys(o);case 4:if((n.t1=n.t0()).done){n.next=13;break}return a=n.t1.value,n.delegateYield(this.getOperation(o[a]),"t2",7);case 7:if(u=n.t2,!u.deleted){n.next=10;break}return n.abrupt("continue",4);case 10:null!=u.opContent?i[a]=u.opContent:s[a]=u.content[0],n.next=4;break;case 13:return n.abrupt("return",new t(e,r,s,i));case 14:case"end":return n.stop()}},n,this)})}))}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.exports=s,"undefined"!=typeof Y&&s(Y)},{}]},{},[1]);
//# sourceMappingURL=y-map.js.map
